---
title: "I have the best titles"
author: Your name here
subtitle: Subtitle here if desired
---

# Introduction
My really awesome and complete introduction will go here.  

# Materials and methods

Narrative and most code will go here.  Describe what you are doing and show how to do it (with code).

You can do bullets like this:

* The first most important thing
* The second most important thing
* The third most important thing

You can do numbers like this:

1. The first most important thing
2. The second most important thing
3. The third most important thing

See [http://rmarkdown.rstudio.com/](http://rmarkdown.rstudio.com/) for all the amazing things you can do.

## Preprocessing
Here's our first code chunk. This loads the ERA5 data and preprocesses them, creating the rasters and dataframes that we need for visualization and analysis. Each file of this dataset contains 24 rasters (correponding to 24 hours of a day) for the variable that you specify.
User should input the year, name of the variable, coordinates of the weather station and directory of the files.
```{r message=F, warning=F, results='hide'}
##########
#Packages#
##########
library(raster)     # managing rasters
library(rgdal)      # managing rasters
library(lubridate)  # managing date formats

runn=F
if(runn){
  Yr<- 2018
  par<- 'skt'     # the variable you are interested in,
                  # and you have it available on your disk
  
  xy= cbind(-78.7358, 42.9408)  # Coordinates of the weather station
                                # this is Buffalo's Niagara International Airport

  # This data frame will be used for time-series plots
  daily_df= data.frame(Date= as.Date(character()),
                       Mean= numeric(),
                       Min= numeric(),
                       Max= numeric(),
                       stringsAsFactors = FALSE)
  monthly_bricks= list()
  monthly_mean= list()
  monthly_min= list()
  monthly_max= list()

  for(y in c(Yr)){
    for(M in 1:12){
      month_path= paste0('PATH TO THE FILES','/Y',Yr,'/M',
                         sprintf("%02d", as.numeric(M)),'/')
      ls= list.files(month_path, recursive = TRUE)
      l= length(ls)
      n= nrow(daily_df)
      everyday_bricks= list()
    
    
    for(i in c(1:l)){
      f_name= paste0(month_path,ls[i])
      day_brick= brick(f_name, varname= par)
      daily_df[n+i,1]= as.Date(substr(f_name,nchar(f_name)-10,nchar(f_name)-3), "%Y%m%d")
      daily_df[n+i,2]= extract(calc(day_brick, mean), xy, method='simple')
      daily_df[n+i,3]= extract(calc(day_brick, min), xy, method='simple')
      daily_df[n+i,4]= extract(calc(day_brick, max), xy, method='simple')
      
      everyday_bricks[i]= day_brick
    }
    monthly_bricks[M]= brick(everyday_bricks)
    monthly_mean[M]= calc(monthly_bricks[[M]],mean)
    monthly_min[M]= calc(monthly_bricks[[M]],min)
    monthly_max[M]= calc(monthly_bricks[[M]],max)
    }
  }
}

```

Load any required packages in a code chunk (you may need to install some packages):

```{r, message=F, warning=F}
library(tidyverse)
library(leaflet)
library(kableExtra)
knitr::opts_chunk$set(cache=TRUE)  # cache the results for quick compiling
```

## Download and clean all required data
```{r}
n=20
data=data.frame(x=runif(n,-180,180),
                y=runif(n,-60,60),
                size = runif(n, 5, 20),
                category = factor(
                  sample(letters[1:5], n, replace = TRUE)
                  ),
                value = rnorm(n))
```

```{r, results='asis'}
data %>% 
  slice(1:10) %>% #show only 1:n rows
  kable(digits=2,align="c")%>% #make table and round to two digits
  kable_styling(bootstrap_options = 
                  c("striped", "hover", "condensed", "responsive")) #apply other formatting
```

Add any additional processing steps here.

# Results

Show tables, plots, etc. and describe them.

```{r, fig.width=6, fig.height=3, fig.cap="Map of completely random data"}
m <- leaflet(data) %>% 
  addTiles() %>% 
  addCircleMarkers(~x, ~y, radius = ~size,color = ~as.factor(category)) %>% 
  addPopups(~x[2], ~y[2], "Random popup")
m  # a map with the default OSM tile layer
```


```{r}
data %>% 
  ggplot(aes(x=x,y=y,col=category))+
  geom_point()
```

# Conclusions

What have you learned?  Are there any broader implications?

# References
